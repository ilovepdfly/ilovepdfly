import{u as j,r as a,j as e,z as S,L as F,au as A}from"./main-B_UUhE-U.js";import*as P from"https://esm.sh/qrcode@1.5.3";const D=r=>{const c="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let t=0,d=0,s="";for(let o=0;o<r.length;o++)for(d=d<<8|r[o],t+=8;t>=5;)s+=c[d>>>t-5&31],t-=5;return t>0&&(s+=c[d<<5-t&31]),s},E=({isOpen:r,onClose:c})=>{const{user:t,updateTwoFactorStatus:d}=j(),[s,o]=a.useState(1),[m,g]=a.useState(""),[x,h]=a.useState(""),[i,u]=a.useState(""),[b,n]=a.useState(""),[p,f]=a.useState(!1),N=()=>{if(t?.username){const l=new Uint8Array(20);window.crypto.getRandomValues(l);const y=D(l);g(y);const v=`otpauth://totp/iLovePDFLY:${t.username}?secret=${y}&issuer=iLovePDFLY`;P.toDataURL(v,(w,C)=>{w?(console.error(w),n("Could not generate QR code. Please try again.")):h(C)})}};a.useEffect(()=>{r&&(o(1),n(""),u(""),N())},[r,t]);const k=async()=>{if(i.length!==6||!/^\d{6}$/.test(i)){n("Please enter a valid 6-digit code.");return}f(!0),n("");try{await d(!0),o(3)}catch(l){n(l.message||"An error occurred. Please try again."),f(!1)}};return r?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:c,children:e.jsx("div",{className:"bg-white dark:bg-black w-full max-w-lg rounded-lg shadow-xl",onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-4",children:"Set up Two-Factor Authentication"}),s===1&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"1. Scan this QR code with your authenticator app (like Google Authenticator)."}),x?e.jsx("img",{src:x,alt:"2FA QR Code",className:"mx-auto border-4 border-white dark:border-black rounded-lg"}):e.jsx("div",{className:"w-48 h-48 bg-gray-200 animate-pulse mx-auto"}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Can't scan? Enter this code manually:"}),e.jsx("code",{className:"block mt-1 p-2 bg-gray-100 dark:bg-gray-800 rounded-md font-mono",children:m}),e.jsx("button",{onClick:()=>o(2),className:"mt-6 w-full bg-brand-red hover:bg-brand-red-dark text-white font-bold py-2 px-4 rounded-md",children:"Next Step"})]}),s===2&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"2. Enter the 6-digit code from your authenticator app to verify."}),e.jsx("input",{type:"text",value:i,onChange:l=>u(l.target.value),maxLength:6,placeholder:"123456",className:"w-48 p-2 text-2xl tracking-[0.5em] text-center border-2 border-gray-300 rounded-md"}),b&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:b}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{onClick:()=>o(1),className:"flex-1 bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded-md",children:"Back"}),e.jsx("button",{onClick:k,disabled:p,className:"flex-1 bg-brand-red hover:bg-brand-red-dark text-white font-bold py-2 px-4 rounded-md disabled:bg-red-300",children:p?"Verifying...":"Verify & Enable"})]})]}),s===3&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 dark:bg-green-900/50 mb-6",children:e.jsx(S,{className:"h-10 w-10 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold",children:"Success!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Two-Factor Authentication has been enabled on your account."}),e.jsx("button",{onClick:c,className:"mt-6 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md",children:"Done"})]})]})})}):null},L=()=>{const{user:r,auth:c,updateTwoFactorStatus:t}=j(),[d,s]=a.useState(!1),[o,m]=a.useState(!1),[g,x]=a.useState(!1),[h,i]=a.useState(""),u=c.currentUser?.providerData.some(n=>n.providerId==="password"),b=async()=>{if(window.confirm("Are you sure you want to disable Two-Factor Authentication? This will reduce your account's security.")){x(!0),i("");try{await t(!1)}catch(n){i(n.message||"Failed to disable 2FA.")}finally{x(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-8 gap-4",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-800 dark:text-gray-100",children:"Security"}),e.jsx(F,{to:"/pricing",className:"bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 px-4 rounded-md flex items-center gap-2 transition-colors text-sm",children:e.jsx("span",{children:"Upgrade to Premium"})})]}),h&&e.jsx("p",{className:"mb-4 text-center text-sm text-red-500 bg-red-100 dark:bg-red-900/30 p-3 rounded-md",children:h}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-surface-dark p-6 rounded-lg shadow-lg border border-gray-200 dark:border-gray-800 flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Password"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2 flex-grow",children:u?"Change the password for your account.":"Create a password to add another sign-in method."}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{onClick:()=>s(!0),className:"text-sm font-semibold text-brand-red hover:underline",children:u?"Change":"Create"})})]}),e.jsxs("div",{className:"bg-white dark:bg-surface-dark p-6 rounded-lg shadow-lg border border-gray-200 dark:border-gray-800 flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Two factor authentication"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Two Factor Authentication improves your account security."}),e.jsxs("div",{className:"flex-grow mt-4 text-gray-600 dark:text-gray-400",children:[e.jsx("p",{children:"You can enable Two Factor Authentication with your current password and a QR given code."}),e.jsxs("p",{className:"mt-2",children:["Status:",e.jsx("span",{className:`font-bold ml-2 ${r?.twoFactorEnabled?"text-green-600 dark:text-green-400":"text-gray-500"}`,children:r?.twoFactorEnabled?"enabled":"disabled"})]})]}),e.jsx("div",{className:"mt-4 text-right",children:r?.twoFactorEnabled?e.jsx("button",{onClick:b,disabled:g,className:"text-sm font-semibold text-brand-red hover:underline disabled:opacity-50",children:g?"Disabling...":"Disable"}):e.jsx("button",{onClick:()=>m(!0),className:"text-sm font-semibold text-brand-red hover:underline",children:"Enable"})})]})]})]}),e.jsx(A,{isOpen:d,onClose:()=>s(!1)}),e.jsx(E,{isOpen:o,onClose:()=>m(!1)})]})};export{L as default};
