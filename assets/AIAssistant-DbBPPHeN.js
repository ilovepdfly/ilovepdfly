import{r as n,t as ge,T as me,j as e,L as be,S as fe,l as pe,aE as M,aC as ye,aF as se,a9 as ae,g as we,V as je,G as ke,aG as Ne,af as F}from"./main-Do_IjlcY.js";import"./react-Ckhrjn13.js";const Ie=()=>{const[c,O]=n.useState("pdf"),[f,G]=n.useState(null),[$,E]=n.useState(""),[h,U]=n.useState(!1),[w,j]=n.useState(""),[z,k]=n.useState(""),[N,B]=n.useState(!1),[g,i]=n.useState(""),[ne,v]=n.useState(!1),[q,C]=n.useState(""),[b,Y]=n.useState(null),[P,m]=n.useState([]),[p,L]=n.useState(""),[S,I]=n.useState(!1),[K,y]=n.useState(""),[A,oe]=n.useState(!1),T=n.useRef(null),[x,_]=n.useState(!1),[H,Q]=n.useState(null),R=n.useRef(null),D=n.useCallback(async(r,t)=>{U(!0),i("");try{const a={data:await r.arrayBuffer()};t&&(a.password=t);const o=await ge(a).promise;v(!1),C("");const l=o.numPages;let u="";for(let d=1;d<=l;d++){const he=(await(await o.getPage(d)).getTextContent()).items.map(te=>"str"in te?te.str:"").join(" ");u+=he+`

`}E(u)}catch(s){if(console.error("PDF Parsing Error:",s),s.name==="PasswordException")t?i("Incorrect password. Please try again."):(v(!0),i(""));else{const a=me.find(o=>o.id==="repair-pdf");i(e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Sorry, we couldn't read this PDF."}),e.jsx("p",{className:"mt-1",children:"The file may be corrupted or in an unsupported format."}),a&&e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("p",{className:"mb-2",children:"You can try to fix it using our Repair tool:"}),e.jsxs(be,{to:`/${a.id}`,className:"inline-flex items-center gap-2 bg-lime-600 hover:bg-lime-700 text-white font-bold py-2 px-4 rounded-lg transition-colors",children:["Go to Repair PDF",a.isPremium&&e.jsx(fe,{className:"h-4 w-4 text-yellow-300"})]})]})]}))}}finally{U(!1)}},[]),le=n.useCallback(r=>{if(r.length>0){const t=r[0];G(t),k(""),i(""),j(""),E(""),v(!1),C(""),D(t)}},[D]),{getRootProps:de,getInputProps:ie,isDragActive:ce}=pe({onDrop:le,accept:{"application/pdf":[".pdf"]},multiple:!1}),J=()=>{f&&D(f,q)},V=()=>{if(!b){const r="AIzaSyCuhbxmzoOTGS6UtX7OZjLwBiMfQNrOzJA",s=new F({apiKey:r}).chats.create({model:"gemini-2.5-flash",config:{systemInstruction:"You are a helpful and friendly AI assistant named PDFLY-AI. Answer user questions clearly and concisely."}});Y(s),P.length===0&&m([{role:"model",text:"Hello! How can I help you today?"}])}};n.useEffect(()=>{c==="chat"&&!b&&V()},[c,b]),n.useEffect(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight)},[P]),n.useEffect(()=>{if(typeof window>"u"||!("SpeechRecognition"in window||"webkitSpeechRecognition"in window)){console.warn("Speech Recognition not supported by this browser.");return}const r=window.SpeechRecognition||window.webkitSpeechRecognition,t=new r;t.continuous=!1,t.lang="en-US",t.interimResults=!1,t.onresult=s=>{const a=s.results[0][0].transcript;c==="pdf"?j(a):L(a)},t.onerror=s=>{console.error("Speech recognition error",s.error),(c==="pdf"?i:y)(`Voice recognition error: ${s.error}. Please ensure microphone permissions are granted.`)},t.onend=()=>{_(!1)},R.current=t},[c]);const X=async()=>{if(!w||!f)return;if(!$&&!h){i("Could not read the PDF content. Please try re-uploading the file.");return}if(h){i("Please wait for the PDF to finish processing before asking a question.");return}const r="AIzaSyCuhbxmzoOTGS6UtX7OZjLwBiMfQNrOzJA";B(!0),i(""),k("");try{const t=new F({apiKey:r}),s=`Based on the content of the document provided below, please answer the user's question.

        DOCUMENT CONTENT:
        ---
        ${$.substring(0,15e3)}
        ---
        
        USER QUESTION: "${w}"`,a=await t.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{systemInstruction:"You are a helpful AI assistant specialized in analyzing and answering questions about PDF documents. Provide clear, concise answers based only on the provided text.",temperature:.5}});k(a.text||"Sorry, no response was generated.")}catch(t){console.error("AI PDF Ask Error:",t);const s=t.message||"";let a="An error occurred while getting the answer. Please try again.";s.toLowerCase().includes("api key")?a="The AI service is currently unavailable. Please check your API key configuration.":s.toLowerCase().includes("safety")?a="Your question or the PDF content may have violated our safety policy. Please try a different question.":a=`Sorry, an error occurred. ${s}`,i(a)}finally{B(!1)}},Z=async()=>{if(!p.trim())return;const r="AIzaSyCuhbxmzoOTGS6UtX7OZjLwBiMfQNrOzJA",t=[...P,{role:"user",text:p}];m(t);const s=p;L(""),I(!0),y("");try{if(A){const o=await new F({apiKey:r}).models.generateContent({model:"gemini-2.5-flash",contents:s,config:{tools:[{googleSearch:{}}]}}),u=o.candidates?.[0]?.groundingMetadata?.groundingChunks?.map(d=>d.web).filter(d=>!!d?.uri)||[];m(d=>[...d,{role:"model",text:o.text||"",sources:u.length>0?u:void 0}])}else{if(!b&&(V(),!b))throw new Error("Chat could not be initialized.");const a=await b.sendMessageStream({message:s});let o="";m(l=>[...l,{role:"model",text:""}]);for await(const l of a)o+=l.text,m(u=>{const d=[...u];return d[d.length-1].text=o,d})}}catch(a){console.error("AI Chat Error:",a);const o=a.message||"";let l="An error occurred. Please try again.";o.toLowerCase().includes("api key")?l="The AI service is currently unavailable. Please check your API key configuration.":o.toLowerCase().includes("safety")?l="Your message may have violated our safety policy. Please try again with a different message.":o.toLowerCase().includes("search")?l="There was an issue with the Google Search grounding. Please try again or disable the search option.":l=`Sorry, an error occurred. ${o}`,y(l),m(u=>[...u,{role:"model",text:l}])}finally{I(!1)}},W=(r,t)=>{navigator.clipboard.writeText(r).then(()=>{Q(t),setTimeout(()=>Q(null),2e3)}).catch(s=>console.error("Failed to copy text: ",s))},xe=()=>{I(!0),y("");const r="AIzaSyCuhbxmzoOTGS6UtX7OZjLwBiMfQNrOzJA",s=new F({apiKey:r}).chats.create({model:"gemini-2.5-flash",config:{systemInstruction:"You are a helpful and friendly AI assistant named PDFLY-AI. Answer user questions clearly and concisely."}});Y(s),m([{role:"model",text:"New chat started. How can I help you?"}]),I(!1)},ee=()=>{x||!R.current||(_(!0),(c==="pdf"?i:y)(""),R.current.start())},ue=()=>{G(null),j(""),k(""),i(""),E(""),v(!1),C("")},re=({label:r,isActive:t,onClick:s})=>e.jsx("button",{onClick:s,className:`px-4 py-2 text-sm font-semibold rounded-t-md transition-colors focus:outline-none ${t?"bg-white dark:bg-black text-brand-red border-b-2 border-brand-red":"text-gray-500 dark:text-gray-400 hover:text-brand-red"}`,children:r});return e.jsx("div",{className:"py-16 md:py-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(M,{className:"h-12 w-12 mx-auto text-brand-red"}),e.jsx("span",{className:"absolute inset-0 rounded-full animate-pulse-glow"})]}),e.jsx("h2",{className:"text-3xl md:text-4xl font-extrabold text-gray-800 dark:text-gray-100 mt-4",children:"Your AI Assistant"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600 dark:text-gray-300",children:"Ask questions about a PDF or have a direct chat with our AI."})]}),e.jsxs("div",{className:"animated-border rounded-xl",children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 px-4 md:px-8 pt-4 flex",children:[e.jsx(re,{label:"Chat with PDF",isActive:c==="pdf",onClick:()=>O("pdf")}),e.jsx(re,{label:"General Chat",isActive:c==="chat",onClick:()=>O("chat")})]}),e.jsxs("div",{className:"p-6 md:p-8",children:[c==="pdf"&&e.jsxs("div",{children:[f?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 mb-4 bg-gray-100 dark:bg-gray-900 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3 overflow-hidden",children:[e.jsx(ye,{className:"h-6 w-6 text-brand-red flex-shrink-0"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium truncate",children:f.name})]}),e.jsx("button",{onClick:ue,className:"text-gray-500 hover:text-red-500 transition-colors flex-shrink-0 ml-4",children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),h&&e.jsx("div",{className:"text-center my-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:e.jsx("p",{className:"text-blue-600 dark:text-blue-300 animate-pulse font-semibold",children:"Reading your PDF..."})}),ne?e.jsxs("div",{className:"mt-4 text-center p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-md border border-yellow-200 dark:border-yellow-800",children:[e.jsx("h3",{className:"font-bold text-yellow-800 dark:text-yellow-300",children:"Password Required"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400 my-2",children:"This PDF is password-protected. Please enter the password to unlock it."}),e.jsxs("div",{className:"flex gap-2 justify-center mt-3",children:[e.jsx("input",{type:"password",value:q,onChange:r=>C(r.target.value),placeholder:"Enter PDF password",className:"flex-grow w-full px-3 py-2 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-md focus:ring-2 focus:ring-brand-red focus:border-transparent",onKeyPress:r=>r.key==="Enter"&&J()}),e.jsx("button",{onClick:J,className:"bg-brand-red hover:bg-brand-red-dark text-white font-bold py-2 px-4 rounded-md transition-colors",children:"Unlock"})]})]}):e.jsxs("div",{className:`flex flex-col sm:flex-row gap-2 ${h||g?"opacity-50 pointer-events-none":""}`,children:[e.jsx("input",{type:"text",value:w,onChange:r=>j(r.target.value),placeholder:"e.g., 'Summarize this document'",className:"flex-grow w-full px-4 py-3 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-md focus:ring-2 focus:ring-brand-red focus:border-transparent text-gray-800 dark:text-gray-200 transition-shadow",disabled:N||x||h||!!g,onKeyPress:r=>r.key==="Enter"&&X()}),e.jsx("button",{onClick:ee,disabled:N||x||h||!!g,className:`p-3 rounded-md border bg-white dark:bg-black transition-colors flex-shrink-0 ${x?"border-red-500 text-red-500 animate-pulse":"border-gray-300 dark:border-gray-700 text-gray-400 hover:text-brand-red hover:border-brand-red"}`,"aria-label":"Use microphone",children:e.jsx(se,{className:"h-6 w-6"})}),e.jsx("button",{onClick:X,disabled:N||!w||x||h||!!g,className:"bg-brand-red hover:bg-brand-red-dark text-white font-bold py-3 px-6 rounded-md transition-all duration-300 disabled:bg-red-300 dark:disabled:bg-red-800 disabled:cursor-not-allowed flex items-center justify-center flex-shrink-0",children:N?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Asking..."]}):"Ask"})]})]}):e.jsxs("div",{...de(),className:`p-10 border-2 border-dashed rounded-lg text-center cursor-pointer transition-colors duration-300 ${ce?"border-brand-red bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600 hover:border-brand-red"}`,children:[e.jsx("input",{...ie()}),e.jsx("p",{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Drag & drop a PDF here, or click to select"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Max file size 10MB"})]}),g&&e.jsx("div",{className:`mt-4 text-center text-sm p-3 rounded-md ${typeof g=="string"?"text-red-500 bg-red-100 dark:bg-red-900/30":"text-gray-800 dark:text-gray-200 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700"}`,children:g}),z&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:"Answer:"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>W(z,"pdf-response"),className:"text-gray-400 hover:text-brand-red transition-colors","aria-label":"Copy answer",children:e.jsx(ae,{className:"h-5 w-5"})}),H==="pdf-response"&&e.jsx("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 text-xs bg-black text-white px-2 py-1 rounded shadow-lg z-10",children:"Copied!"})]})]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none bg-gray-50 dark:bg-black border border-gray-200 dark:border-gray-800 p-4 rounded-md",children:e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:z})})]})]}),c==="chat"&&e.jsxs("div",{className:"flex flex-col h-[70vh] max-h-[600px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Conversation"}),e.jsxs("button",{onClick:xe,className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-brand-red transition-colors","aria-label":"Start new chat",children:[e.jsx(we,{className:"h-4 w-4"}),"New Chat"]})]}),e.jsxs("div",{ref:T,className:"flex-grow overflow-y-auto pr-4 space-y-6",children:[P.map((r,t)=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:`flex items-start gap-3 w-full group ${r.role==="user"?"justify-end":"justify-start"}`,children:[r.role==="model"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-brand-red/20 flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-brand-red"})}),e.jsx("div",{className:"p-3 rounded-lg max-w-md bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200",children:e.jsx("p",{className:"text-sm",style:{whiteSpace:"pre-wrap"},children:r.text})}),e.jsxs("div",{className:"relative self-center",children:[e.jsx("button",{onClick:()=>W(r.text,`chat-${t}`),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-brand-red transition-all duration-200","aria-label":"Copy message",children:e.jsx(ae,{className:"h-4 w-4"})}),H===`chat-${t}`&&e.jsx("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 text-xs bg-black text-white px-2 py-1 rounded shadow-lg z-10",children:"Copied!"})]})]}),r.role==="user"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 rounded-lg max-w-md bg-blue-500 text-white",children:e.jsx("p",{className:"text-sm",style:{whiteSpace:"pre-wrap"},children:r.text})}),e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:e.jsx(je,{className:"h-5 w-5 text-gray-500 dark:text-gray-300"})})]})]}),r.sources&&r.sources.length>0&&e.jsxs("div",{className:"ml-11 mt-2 max-w-md",children:[e.jsxs("h4",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 flex items-center gap-1.5 mb-1",children:[e.jsx(ke,{className:"h-3.5 w-3.5"})," Sources"]}),e.jsx("div",{className:"flex flex-col gap-1.5",children:r.sources.map((s,a)=>e.jsx("a",{href:s.uri,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 p-2 rounded-md hover:underline truncate",children:s.title||s.uri},a))})]})]},t)),S&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-brand-red/20 flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-brand-red"})}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-200 dark:bg-gray-800 flex items-center",children:[e.jsx("span",{className:"h-2 w-2 bg-brand-red rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("span",{className:"h-2 w-2 bg-brand-red rounded-full animate-bounce [animation-delay:-0.15s] mx-1"}),e.jsx("span",{className:"h-2 w-2 bg-brand-red rounded-full animate-bounce"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:r=>L(r.target.value),placeholder:"Type your message...",className:"flex-grow w-full px-4 py-2 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-full focus:ring-2 focus:ring-brand-red focus:border-transparent text-gray-800 dark:text-gray-200 transition-shadow",disabled:S||x,onKeyPress:r=>r.key==="Enter"&&Z()}),e.jsx("button",{onClick:ee,disabled:S||x,className:`w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center transition-colors ${x?"bg-red-500 text-white animate-pulse":"bg-white dark:bg-black border border-gray-300 dark:border-gray-700 text-gray-400 hover:text-brand-red hover:border-brand-red"}`,"aria-label":"Use microphone",children:e.jsx(se,{className:"h-5 w-5"})}),e.jsx("button",{onClick:Z,disabled:S||!p.trim()||x,className:"w-10 h-10 flex-shrink-0 bg-brand-red hover:bg-brand-red-dark text-white font-bold rounded-full transition-all duration-300 disabled:bg-red-300 dark:disabled:bg-red-800 disabled:cursor-not-allowed flex items-center justify-center","aria-label":"Send message",children:e.jsx(Ne,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-2 flex items-center justify-center gap-2",children:e.jsxs("label",{htmlFor:"google-search-toggle",className:"flex items-center cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",id:"google-search-toggle",className:"sr-only",checked:A,onChange:()=>oe(!A)}),e.jsx("div",{className:"block bg-gray-200 dark:bg-gray-700 w-10 h-6 rounded-full"}),e.jsx("div",{className:`dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform ${A?"translate-x-full bg-brand-red":""}`})]}),e.jsx("div",{className:"ml-2 text-xs text-gray-600 dark:text-gray-300 font-semibold",children:"Search with Google"})]})}),K&&e.jsx("p",{className:"text-xs text-red-500 text-center mt-2",children:K})]})]})]})]})]})})};export{Ie as default};
