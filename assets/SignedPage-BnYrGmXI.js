import{c as O,r as i,j as e,J as T,aF as w,aG as E,ac as R}from"./main-2dW-_gCS.js";import{E as z}from"./jspdf.es.min-DYr5F78f.js";import{u as I}from"./useSignedDocuments-CPQWeTds.js";import"./react-Dazix4UH.js";const $=({doc:a,onClose:o})=>{if(!a)return null;let c=[];try{c=JSON.parse(a.auditTrail)}catch(d){console.error("Could not parse audit trail",d)}return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:o,children:e.jsxs("div",{className:"bg-white dark:bg-black w-full max-w-2xl rounded-lg shadow-xl",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Document Details"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-800 dark:text-gray-100",children:"File Information"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Original File:"})," ",a.originalFileName]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Signed File:"})," ",a.signedFileName]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:"text-green-600 font-semibold",children:a.status})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Created At:"})," ",new Date(a.createdAt).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-800 dark:text-gray-100",children:"Signers"}),a.signers.map((d,x)=>e.jsxs("div",{className:"text-sm border-t pt-2 mt-2 first:border-t-0",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",d.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Signed At:"})," ",new Date(d.signedAt).toLocaleString()]})]},x))]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-800 dark:text-gray-100",children:"Audit Trail"}),e.jsx("pre",{className:"text-xs bg-gray-100 dark:bg-gray-800 p-2 rounded-md whitespace-pre-wrap",children:JSON.stringify(c,null,2)})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-b-lg text-right",children:e.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold border rounded-md bg-white dark:bg-gray-700 hover:bg-gray-100",children:"Close"})})]})})},J=({className:a})=>e.jsx("div",{className:`p-2 bg-blue-600 rounded-md inline-block ${a}`,children:e.jsx("svg",{className:"h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})}),V=()=>{const a=O(),{documents:o,loading:c,deleteSignedDocument:d}=I(),[x,b]=i.useState(null),[y,j]=i.useState(!1),u=i.useRef(null),[v,f]=i.useState(null),[g,S]=i.useState(""),N={startDate:"",endDate:"",statuses:{signed:!0,voided:!1,declined:!1,expired:!1,deleted:!1}},[l,m]=i.useState(N);i.useEffect(()=>{const t=r=>{u.current&&!u.current.contains(r.target)&&b(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const D=()=>{a("/sign-pdf")},k=(t,r)=>{const n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)},C=t=>{const r=new z;r.setFontSize(18),r.text("Audit Trail Report",14,22),r.setFontSize(12),r.text(`Document: ${t.signedFileName}`,14,35),r.text(`Created: ${new Date(t.createdAt).toLocaleString()}`,14,42),r.text(`Status: ${t.status}`,14,49),r.setFontSize(14),r.text("Events:",14,62),r.setFontSize(10);let n="No audit trail available.";try{n=JSON.stringify(JSON.parse(t.auditTrail),null,2)}catch(p){console.error("Error parsing audit trail:",p)}const s=r.splitTextToSize(n,180);r.text(s,14,68),r.save(`audit_trail_${t.id}.pdf`)},h=i.useMemo(()=>o.filter(t=>{const r=new Date(t.createdAt),n=g===""||t.signedFileName.toLowerCase().includes(g.toLowerCase())||t.originator.toLowerCase().includes(g.toLowerCase()),s=!l.startDate||r>=new Date(l.startDate),p=!l.endDate||r<=new Date(l.endDate+"T23:59:59"),A=l.statuses.signed&&t.status==="Signed";return n&&s&&p&&A}),[o,g,l]),F=()=>{m(N)},L=t=>{const{name:r,checked:n}=t.target;m(s=>({...s,statuses:{...s.statuses,[r]:n}}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full bg-white dark:bg-surface-dark rounded-lg shadow-lg border border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(J,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-7 w-auto"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Signature"})]})]}),e.jsx("button",{onClick:D,className:"w-full sm:w-auto bg-brand-red hover:bg-brand-red-dark text-white font-bold py-2 px-6 rounded-md transition-colors",children:"New signature"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6",children:"Processed documents"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:[e.jsxs("button",{onClick:()=>j(!y),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-semibold text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center justify-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"})," Filters"]}),e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx("input",{type:"text",placeholder:"Search here...",value:g,onChange:t=>S(t.target.value),className:"w-full pl-4 pr-10 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 focus:ring-brand-red focus:border-brand-red"}),e.jsx("button",{className:"absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-gray-600",children:e.jsx(E,{className:"h-5 w-5"})})]})]}),y&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-6 rounded-lg border border-gray-200 dark:border-gray-700 mb-4 animate-fade-in-down",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:"Creation Date"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"date",value:l.startDate,onChange:t=>m(r=>({...r,startDate:t.target.value})),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-sm"}),e.jsx("input",{type:"date",value:l.endDate,onChange:t=>m(r=>({...r,endDate:t.target.value})),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2",children:Object.keys(l.statuses).map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:t,checked:l.statuses[t],onChange:L,className:"h-4 w-4 rounded text-brand-red focus:ring-brand-red"}),t.charAt(0).toUpperCase()+t.slice(1)]},t))})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:F,className:"text-sm font-semibold text-gray-600 dark:text-gray-300 hover:underline",children:"Clear filters"}),e.jsx("button",{onClick:()=>j(!1),className:"px-6 py-2 bg-brand-red text-white font-bold rounded-md hover:bg-brand-red-dark",children:"Apply"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Request originator"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"File"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Creation Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{children:[c&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-8 text-gray-500",children:"Loading signed documents..."})}),!c&&h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-8 text-gray-500",children:"No signed documents found."})}),!c&&h.map(t=>e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-800 dark:text-gray-100",children:t.originator}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-100",children:t.signedFileName}),e.jsxs("p",{className:"text-xs text-blue-500 font-semibold",children:[t.signers.length," signer(s)"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-200",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["Signed on ",new Date(t.signers[0].signedAt).toLocaleDateString()]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 text-xs font-semibold text-green-800 bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-full",children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("div",{ref:x===t.id?u:null,className:"relative inline-block",children:[e.jsxs("button",{onClick:()=>b(x===t.id?null:t.id),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-semibold text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2",children:["Download ",e.jsx(w,{className:`h-4 w-4 transition-transform ${x===t.id?"rotate-180":""}`})]}),x===t.id&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-md shadow-lg z-10 text-left",children:[e.jsx("button",{onClick:()=>{f(t),b(null)},className:"w-full text-left block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"View details"}),e.jsx("button",{onClick:()=>k(t.signedFile,t.signedFileName),className:"w-full text-left block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Download signed documents"}),e.jsx("button",{onClick:()=>C(t),className:"w-full text-left block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Download Audit"}),e.jsx("button",{onClick:()=>k(t.originalFile,t.originalFileName),className:"w-full text-left block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Download Original"})]})]}),e.jsx("button",{onClick:()=>d(t.id),className:"p-2 text-gray-400 hover:text-red-500 rounded-full",title:"Delete Record",children:e.jsx(R,{className:"h-5 w-5"})})]})})]},t.id))]})]})}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["1-",h.length," of ",h.length]})]})]}),e.jsx($,{doc:v,onClose:()=>f(null)})]})};export{V as default};
